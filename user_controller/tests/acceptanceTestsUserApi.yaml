---
- config:
    - testset: "BrewStand_UserAPI Tests"
    - timeout: 100

- test:
    - name: "Create user"
    - url: "/user-api/user"
    - method: "POST"
    - headers: {Content-Type: "application/json"}
    - body: '{"username": "Raul","address": "Amadora City"}'
    - expected_status: [200]
    - expected_body_contains: ["token"]

- test:
    - name: "Add item to cart"
    - url: "/user-api/user/cart"
    - method: "PUT"
    - headers: {Authorization: "Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IkFhOHdVMXJIM2tPOFg4TFdnNWhhZCJ9", Content-Type: "application/json"}
    - body: '{"batchID": 10,"volume": 38.5}'
    - expected_status: [200]

- test:
    - name: "Get cart contents"
    - url: "/user-api/user/cart"
    - method: "GET"
    - headers: {Authorization: "Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IkFhOHdVMXJIM2tPOFg4TFdnNWhhZCJ9"}
    - expected_status: [200]
    - expected_body_contains: ["items", "totalCost"]

- test:
    - name: "Remove item from cart"
    - url: "/user-api/user/cart?itemId=10"
    - method: "DELETE"
    - headers: {Authorization: "Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IkFhOHdVMXJIM2tPOFg4TFdnNWhhZCJ9"}
    - expected_status: [200]

- test:
    - name: "Checkout cart"
    - url: "/user-api/user/cart/payment"
    - method: "POST"
    - headers: {Authorization: "Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IkFhOHdVMXJIM2tPOFg4TFdnNWhhZCJ9", Content-Type: "application/json"}
    - body: '{"cardNumber": "1111111111111111","cardExpiry": "12/25","cardCvc": "123"}'
    - expected_status: [200]
    - expected_body_contains: ["invoiceID", "price", "orderID", "customerID", "fiscalAddress", "details"]

- test:
    - name: "Create user with invalid data"
    - url: "/user-api/user"
    - method: "POST"
    - headers: {Content-Type: "application/json"}
    - body: '{"username": "","address": ""}'
    - expected_status: [400]

- test:
    - name: "Add item to cart with invalid token"
    - url: "/user-api/user/cart"
    - method: "PUT"
    - headers: {Authorization: "Bearer INVALID_TOKEN", Content-Type: "application/json"}
    - body: '{"batchID": 10,"volume": 38.5}'
    - expected_status: [403]

- test:
    - name: "Get cart contents with invalid token"
    - url: "/user-api/user/cart"
    - method: "GET"
    - headers: {Authorization: "Bearer INVALID_TOKEN"}
    - expected_status: [403]

- test:
    - name: "Remove item from cart with invalid token"
    - url: "/user-api/user/cart?itemId=10"
    - method: "DELETE"
    - headers: {Authorization: "Bearer INVALID_TOKEN"}
    - expected_status: [403]

- test:
    - name: "Checkout cart with invalid token"
    - url: "/user-api/user/cart/payment"
    - method: "POST"
    - headers: {Authorization: "Bearer INVALID_TOKEN", Content-Type: "application/json"}
    - body: '{"cardNumber": "1111111111111111","cardExpiry": "12/25","cardCvc": "123"}'
    - expected_status: [403]

- test:
    - name: "Checkout empty cart"
    - url: "/user-api/user/cart/payment"
    - method: "POST"
    - headers: {Authorization: "Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6IkFhOHdVMXJIM2tPOFg4TFdnNWhhZCJ9", Content-Type: "application/json"}
    - body: '{"cardNumber": "1111111111111111","cardExpiry": "12/25","cardCvc": "123"}'
    - expected_status: [500]
    - expected_body_contains: ["Cart is empty"]

